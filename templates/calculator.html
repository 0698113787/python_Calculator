<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='calculator.css') }}">
</head>
<body class="light-mode">
    <div class="calculator">
        <div class="header">
            <div class="title">Calculator</div>
            <button class="mode-toggle" onclick="toggleMode()">
                <i class="fas fa-moon"></i> Dark Mode
            </button>
        </div>
        
        <div class="display-container">
            <div class="display-history" id="history">{{ history }}</div>
            <div class="display" id="display">{{ display }}</div>
        </div>
        
        <div class="buttons">
            <button class="clear-btn" onclick="sendAction('clear')">AC</button>
            <button class="func-btn" onclick="sendAction('delete')">⌫</button>
            <button class="func-btn percent-btn" onclick="sendAction('append', '%')">%</button>
            <button class="op-btn" onclick="sendAction('append', '/')">÷</button>
            
            <button class="num-btn" onclick="sendAction('append', '7')">7</button>
            <button class="num-btn" onclick="sendAction('append', '8')">8</button>
            <button class="num-btn" onclick="sendAction('append', '9')">9</button>
            <button class="op-btn" onclick="sendAction('append', '*')">×</button>
            
            <button class="num-btn" onclick="sendAction('append', '4')">4</button>
            <button class="num-btn" onclick="sendAction('append', '5')">5</button>
            <button class="num-btn" onclick="sendAction('append', '6')">6</button>
            <button class="op-btn" onclick="sendAction('append', '-')">−</button>
            
            <button class="num-btn" onclick="sendAction('append', '1')">1</button>
            <button class="num-btn" onclick="sendAction('append', '2')">2</button>
            <button class="num-btn" onclick="sendAction('append', '3')">3</button>
            <button class="op-btn" onclick="sendAction('append', '+')">+</button>
            
            <button class="num-btn zero-btn" onclick="sendAction('append', '0')">0</button>
            <button class="num-btn" onclick="sendAction('append', '.')">.</button>
            <button class="func-btn" onclick="sendAction('parenthesis', '(')">(</button>
            <button class="func-btn" onclick="sendAction('parenthesis', ')')">)</button>
            
            <button class="func-btn" onclick="sendAction('square')">x²</button>
            <button class="func-btn" onclick="sendAction('sqrt')">√</button>
            <button class="func-btn" onclick="sendAction('toggle_sign')">+/−</button>
            <button class="equal-btn" onclick="sendAction('calculate')">=</button>
        </div>
    </div>

    <script>
        function sendAction(action, value = '') {
            const formData = new FormData();
            formData.append('action', action);
            if (value) {
                formData.append('value', value);
            }

            fetch('/', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(html => {
                // Parse the HTML response to extract display and history values
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                const newDisplay = doc.getElementById('display').textContent;
                const newHistory = doc.getElementById('history').textContent;
                
                // Update only the display elements without reloading the page
                document.getElementById('display').textContent = newDisplay;
                document.getElementById('history').textContent = newHistory;
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function toggleMode() {
            const body = document.body;
            const button = document.querySelector('.mode-toggle');
            const icon = button.querySelector('i');
            
            if (body.classList.contains('light-mode')) {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                icon.className = 'fas fa-sun';
                button.innerHTML = '<i class="fas fa-sun"></i> Light Mode';
            } else {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                icon.className = 'fas fa-moon';
                button.innerHTML = '<i class="fas fa-moon"></i> Dark Mode';
            }
        }
    </script>
</body>
</html>